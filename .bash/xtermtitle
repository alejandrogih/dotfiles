#!/usr/bin/env bash
# netj's bash module: xterm dynamic title
# Author: Jaeho Shin <netj@sparcs.org>
# Created: 2004-05-28
# Requires: environment screen

bash_autoload=true

bash_import() {
    xtermtitle_label_default=
    bash_default xtermtitle_label ""
}

bash_load() {
    # xterm's dynamic title for some terminal types
    case $TERM in
        xterm* | cygwin* | screen* | dtterm)
        local tty=`tty`
        tty=${tty#/dev/}
        if [ -n "$TMUX" -o -n "$STY" ]; then
            # in tmux or screen (hostname will be shown by it)
            local t=$tty
            [ ! -e "$screen_env" ] || t+="#`screen_current`"
            xtermtitle_label_default=$t
        else
            # plain terminal
            local t=
            local u=${LOGNAME:-$USER}
            [ "$u" = "netj" ] || t+="$u@"
            t+="$hostnickname^$tty"
            xtermtitle_label_default=$t
        fi
        # xterm title controller
        title() {
            xtermtitle_label=${*:-$xtermtitle_label_default}
        }
        # xterm title updater
        xterm_title() {
            local title="\033]0;"
            title+=$xtermtitle_label
            title+="\007"
            echo -ne "$title"
        }
        # use default if necessary
        title "$xtermtitle_label"
        # register it
        bash_add_prompt xterm_title
        ;;
    esac
}

# vim:et:ts=8:sw=4:sts=4
